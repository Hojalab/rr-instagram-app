<div class="container">
	<div class="row-fluid">
		<div class="span12">
			<h1 class="hidden">Instagram#trending</h1>
			 
			<div class="well">
				<div id="leaflet_map_canvas" style="min-height: 350px;" class="map-canvas"></div>
			</div>
			 
		</div>
	</div>
</div>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="http://jquery-ui-map.googlecode.com/svn/trunk/ui/min/jquery.ui.map.full.min.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
<!--[if lte IE 8]>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" />
<![endif]-->
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
<script>
	$(document).ready(function() {
		var map = null;
		var init = function() {
			getLocation();
			getTrendingData();
			// create a map in the "map" div, set the view to a given place and zoom
			map = L.map('leaflet_map_canvas').setView([38.6883767, -121.27403729], 15);
			L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
				attribution : '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
			
		}
		var addLMarker = function(obj) {
			// add a marker in the given location, attach some popup content to it and open the popup
			L.marker([obj.latitude, obj.longitude]).addTo(map).bindPopup(obj.name).openPopup();
		}
		
		
		
		
		var $marker = null;
		
		
		function getLocation() {
			if(navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				$('.message').html("Geolocation is not supported by this browser.");
			}
		}

		function getTrendingData() {
			$.get('/data/locations.json').done(function(data) {
				console.log(data);
				$.each(data.data, function(index, obj) {
					addLMarker(obj);
				});
			});
		}

		//Place marker on map
		function showPosition(position) {
			var circle = L.circle([position.coords.latitude, position.coords.longitude], 500, {
				color : 'red',
				fillColor : '#f03',
				fillOpacity : 0.5
			}).addTo(map);
			var options = {
				draggable: true
			};
			// add a marker in the given location, attach some popup content to it and open the popup
			var $marker = L.marker([position.coords.latitude, position.coords.longitude], options).addTo(map).bindPopup('Your current location').openPopup();
			$marker.on('dragstart', function(e){
				console.log(e, 'dragging');
			})
			$marker.on('dragend', function(e){
				console.log(e.target._latlng, 'dragging end');
			})
		}

		//Init map and get users location
		init();
	});

</script>
